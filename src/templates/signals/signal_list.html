{% extends "index.html" %}


{% load i18n %}

{% block content %}


<div class="pagetitle">
  <h1>Signals</h1>
  <nav>
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{% url 'signals' %}">Home</a></li>
      <li class="breadcrumb-item active">Signals</li>
    </ol>
  </nav>
</div><!-- End Page Title -->

<section class="section dashboard">
  <div class="d-flex flex-column flex-xl-row gap-4">

    <!-- Left side columns -->
    <div class="col">
      <div class="row">
        <div class="col-12">
          <div class="card recent-sales overflow-auto">
            <div class="card-body">
              <div class="col-12 d-flex justify-content-between">
                <div class="col-6">
                  <h5 class="card-title">Signals</h5>
                </div>
                <div class="col-6  d-flex justify-content-end align-items-center">
                  <a href="#" id="toggle-search-panel-btn">
                    <i class="bi bi-filter-right fs-3"></i>
                  </a>
                </div>
              </div>
              <table class="table table-borderless table-hover">
                <thead>
                  <tr>
                    <th scope="col">Name</th>
                    <th scope="col">Data Source</th>
                    <th scope="col">Description</th>
                    <th scope="col">Pathogen/Disease Area</th>
                    <th scope="col">Base Signal</th>
                  </tr>
                </thead>
                <tbody>
                  {% for signal in signals %}
                  <tr class="clickable-table-row" onClick="location.href='{% url 'signal' pk=signal.id %}';">
                    <td>{{ signal.display_name }}</td>
                    <td>{{ signal.source }}</td>
                    <td>{{ signal.description }}</td>
                    <td>
                      {% for pathogen in signal.pathogen.all %}
                        <span class="badge rounded-pill bg-dark">{{ pathogen|title }}</span>
                      {% endfor %}
                    </td>
                    <td>
                      {% if signal.base %}
                        <a href="{% url 'signal' pk=signal.base.id %}">{{ signal.base.id }}</a>
                      {% else %}
                        --/--
                      {% endif %}
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>

            </div>
            {% block pagination %}
              {%include 'pagination.html'%}
            {% endblock %}
          </div>
        </div>

      </div>
    </div><!-- End Left side columns -->

    <!-- Right side columns -->
    <div class="toggled-search-panel">
      <!-- Filters -->
      <div class="card">
        <form method="GET">
          <div class="form-group">
            <div class="card-body">
              <h5 class="card-title">Search</h5>
              <input class="form-control" type="text" name="{{ filter.form.search.name }}" placeholder="Search" title="Enter search keyword"
                {% if "search" in url_params_dict %}
                    value="{{ url_params_dict.search }}"
                {% endif %}>
            </div>
          <div class="form-group">
            <div class="card-body">
              <h5 class="card-title">{{ filter.form.pathogen.label }}</h5>
              <select name="{{ filter.form.pathogen.name }}" class="form-select">
                <option value="">---------</option>
                {% for choice in filter.form.pathogen.field.choices %}
                  <option value="{{ choice.0 }}"
                    {% if "pathogen" in url_params_dict %}
                        {% if choice.0 in url_params_dict.pathogen %}
                            selected
                        {% endif %}
                    {% endif %}
                  >{{ choice.1 }}</option>
                {% endfor %}
              </selectright>
            </div>
          </div>
          <div class="form-group">
            <div class="card-body">
              <h5 class="card-title">{{ filter.form.active.label }}</h5>
              <select name="{{ filter.form.active.name }}" class="form-select" >
                  <option value="">---------</option>
                  <option value="True">True</option>
                  <option value="False">False</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <div class="card-body">
              <h5 class="card-title">{{ filter.form.available_geography.label }}</h5>
              <select
                name="{{ filter.form.available_geography.name }}" class="form-select" multiple
                data-bs-toggle="tooltip" data-bs-placement="bottom"
                data-bs-original-title='{% trans "Hold down “Control”, or “Command” on a Mac, to select more than one." %}'
              >
                {% for choice in filter.form.available_geography.field.choices %}
                  <option value="{{ choice.0 }}"
                    {% if "available_geography" in url_params_dict %}
                        {% if choice.0 in url_params_dict.available_geography %}
                            selected
                        {% endif %}
                    {% endif %}
                    >{{ choice.1 }}</option>
                  {% endfor %}
              </select>
            </div>
          </div>
          <div class="form-group">
            <div class="card-body">
              <h5 class="card-title">{{ filter.form.signal_type.label }}</h5>
              <select
                name="{{ filter.form.signal_type.name }}" class="form-select" multiple
                data-bs-toggle="tooltip" data-bs-placement="bottom"
                data-bs-original-title='{% trans "Hold down “Control”, or “Command” on a Mac, to select more than one." %}'
              >
                {% for choice in filter.form.signal_type.field.choices %}
                  <option value="{{ choice.0 }}"
                    {% if "signal_type" in url_params_dict %}
                        {% if choice.0 in url_params_dict.signal_type %}
                            selected
                        {% endif %}
                    {% endif %}
                  >{{ choice.1 }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
          <div class="form-group">
            <div class="card-body">
              <h5 class="card-title">{{ filter.form.category.label }}</h5>
              <select
                name="{{ filter.form.category.name }}" class="form-select" multiple
                data-bs-toggle="tooltip" data-bs-placement="bottom"
                data-bs-original-title='{% trans "Hold down “Control”, or “Command” on a Mac, to select more than one." %}'
              >
                {% for choice in filter.form.category.field.choices %}
                  <option value="{{ choice.0 }}"
                    {% if "category" in url_params_dict %}
                        {% if choice.0 in url_params_dict.category %}
                            selected
                        {% endif %}
                    {% endif %}
                  >{{ choice.1 }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
          <div class="form-group">
            <div class="card-body">
              <h5 class="card-title">{{ filter.form.format.label }}</h5>
              <select name="{{ filter.form.format.name }}" class="form-select">
                {% for choice in filter.form.format.field.choices %}
                  <option value="{{ choice.0 }}"
                    {% if "format" in url_params_dict %}
                        {% if choice.0 in url_params_dict.format %}
                            selected
                        {% endif %}
                    {% endif %}
                  >{{ choice.1 }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
          <div class="form-group">
            <div class="card-body"><<<<<<< issue-#34-preserve-search-params
              <h5 class="card-title">{{ filter.form.source.label }}</h5>
              <select name="{{ filter.form.source.name }}" class="selectpicker form-select" multiple
                data-bs-toggle="tooltip" data-bs-placement="bottom"
                data-bs-original-title='{% trans "Hold down “Control”, or “Command” on a Mac, to select more than one." %}'
              >
                {% for choice in filter.form.source.field.choices %}
                  <option value="{{ choice.0 }}"
                    {% if "source" in url_params_dict %}
                        {% if choice.0 in url_params_dict.source %}
                            selected
                        {% endif %}
                    {% endif %}
                  >{{ choice.1 }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
          <div class="form-group">
            <div class="card-body">
              <h5 class="card-title">Temporal resolution</h5>
              <select name="{{ filter.form.time_label.name }}" class="selectpicker form-select">
                {% for choice in filter.form.time_label.field.choices %}
                  <option value="{{ choice.0 }}"
                    {% if "time_label" in url_params_dict %}
                        {% if choice.0 in url_params_dict.time_label %}
                            selected
                        {% endif %}
                    {% endif %}
                  >{{ choice.1 }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
        <div class="card-body">
          <div class="d-grid gap-2 mt-3">
            <button type="submit" class="btn btn-primary">{% trans "Apply Filters" %}</button>
          </div>
        </div>
        </form>
      </div><!-- End Filters -->

    </div><!-- End Right side columns -->
    <style>
      .clickable-table-row{
          cursor:pointer;
      }
      .is-search-panel-visible .toggled-search-panel{
        width: 35%;
        height: auto;
      }
      .toggled-search-panel{
        width: 0;
        height: 0;
        transition: 0.4s linear;
        overflow: hidden;
      }
      .toggled-search-panel .card{
        opacity: 0;
        transition: 0.3s linear;
      }
      .is-search-panel-visible .toggled-search-panel .card{
        opacity: 1;
      }
      .animated .toggled-search-panel{
        height: auto!important;
      }

      @media (max-width: 1200px) {
        .is-search-panel-visible .toggled-search-panel{
          width: 100%;
          height: auto;
        }
      }
    </style>
    <script>
      (function () {
        "use strict";

        /**
         * Easy selector helper function
         */
        const select = (el, all = false) => {
            el = el.trim()
            if (all) {
                return [...document.querySelectorAll(el)]
            } else {
                return document.querySelector(el)
            }
        }

        /**
         * Easy event listener function
         */
        const on = (type, el, listener, all = false) => {
            if (all) {
                select(el, all).forEach(e => e.addEventListener(type, listener))
            } else {
                select(el, all).addEventListener(type, listener)
            }
        }

        /**
         * Easy on scroll event listener
         */
        const onscroll = (el, listener) => {
            el.addEventListener('scroll', listener)
        }

        // /**
        //  * Search bar toggle
        //  */

        if (select('#toggle-search-panel-btn')) {
            on('click', '#toggle-search-panel-btn', function (e) {
                select('body').classList.toggle('is-search-panel-visible')
                select('body').classList.add('animated');
                setTimeout(function () {
                    select('body').classList.remove('animated');
                }, 400);
            })
        }
      })()
    </script>
  </div>
</section>

{% endblock %}
